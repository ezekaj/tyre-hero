<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Tyre Service | TyreHero</title>
    <meta name="description" content="24/7 emergency mobile tyre fitting service with 90-minute response time. We come to you at home, work, or roadside.">
    
    <!-- Performance Optimizations -->
    <meta name="theme-color" content="#E53935">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- DNS Prefetch and Preconnect -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Critical CSS Inline -->
    <style>
        /* Critical CSS inlined for immediate rendering */
        :root{--primary:#E53935;--primary-dark:#C62828;--secondary:#FFCC00;--accent:#1A2A56;--dark:#212121;--white:#FFFFFF;--heading-font:'Montserrat',system-ui,-apple-system,sans-serif;--body-font:'Poppins',system-ui,-apple-system,sans-serif;--transition-fast:0.2s ease;--radius-lg:16px;--spacing-md:1rem;--spacing-lg:1.5rem;--spacing-xl:2rem}*{margin:0;padding:0;box-sizing:border-box}html{font-size:16px}body{font-family:var(--body-font);color:var(--dark);background-color:var(--white);line-height:1.6;overflow-x:hidden}h1,h2,h3{font-family:var(--heading-font);font-weight:700;line-height:1.2;margin-bottom:var(--spacing-md)}h1{font-size:2.5rem;font-weight:800}h2{font-size:2rem}.container{max-width:1200px;margin:0 auto;padding:0 var(--spacing-md)}.emergency-call-fixed{position:fixed;bottom:20px;right:20px;z-index:9999;animation:pulse-glow 2s infinite}.pulse-button{width:70px;height:70px;background:linear-gradient(45deg,var(--primary),var(--primary-dark));border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--white);text-decoration:none;box-shadow:0 4px 20px rgba(229,57,53,0.4);transition:all var(--transition-fast);border:3px solid var(--white)}.pulse-button:hover{transform:scale(1.1);box-shadow:0 6px 30px rgba(229,57,53,0.6)}.pulse-button svg{width:28px;height:28px}@keyframes pulse-glow{0%,100%{box-shadow:0 4px 20px rgba(229,57,53,0.4),0 0 0 0 rgba(229,57,53,0.7)}50%{box-shadow:0 4px 20px rgba(229,57,53,0.4),0 0 0 20px rgba(229,57,53,0)}}.site-header{position:fixed;top:0;left:0;width:100%;background-color:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-bottom:1px solid rgba(0,0,0,0.1);z-index:1000;transition:all var(--transition-fast)}.header-content{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-md) 0}.logo-image{height:40px;width:auto}.emergency-hero{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);padding:8rem 0 4rem;position:relative;overflow:hidden;min-height:100vh;display:flex;align-items:center}.emergency-hero::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:url('images/emergency-bg.jpg') center/cover no-repeat;opacity:0.2;z-index:0}.emergency-hero-content{position:relative;z-index:1;max-width:600px}.hero-title{font-size:3.5rem;margin-bottom:var(--spacing-lg);text-shadow:2px 2px 4px rgba(0,0,0,0.3)}.hero-description{font-size:1.2rem;margin-bottom:var(--spacing-xl);opacity:0.9}.btn{display:inline-flex;align-items:center;gap:var(--spacing-md);padding:1rem 2rem;border:none;border-radius:var(--radius-lg);font-family:var(--body-font);font-weight:600;text-decoration:none;cursor:pointer;transition:all var(--transition-fast);position:relative;overflow:hidden}.btn-primary{background:linear-gradient(45deg,var(--primary),var(--primary-dark));color:var(--white);box-shadow:0 4px 15px rgba(229,57,53,0.3)}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(229,57,53,0.4)}.btn-secondary{background:linear-gradient(45deg,var(--secondary),#FFB300);color:var(--dark);box-shadow:0 4px 15px rgba(255,204,0,0.3)}.btn-lg{padding:1.25rem 2.5rem;font-size:1.1rem}.btn-icon svg{width:20px;height:20px}.preloader{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,var(--primary),var(--accent));z-index:10000;display:flex;align-items:center;justify-content:center;opacity:1;transition:opacity 0.5s ease}.preloader.fade-out{opacity:0;pointer-events:none}.preloader-content{text-align:center;color:var(--white)}.preloader-logo{animation:float 2s ease-in-out infinite;margin-bottom:var(--spacing-lg)}.preloader-text{font-family:var(--heading-font);font-size:1.5rem;font-weight:800;margin-bottom:var(--spacing-lg)}.preloader-spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,0.3);border-top:3px solid var(--white);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@media (max-width:768px){.hero-title{font-size:2.5rem}.emergency-call-fixed{bottom:15px;right:15px}.pulse-button{width:60px;height:60px}.pulse-button svg{width:24px;height:24px}.container{padding:0 1rem}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.emergency-form-container{background-color:var(--white);border-radius:var(--radius-lg);box-shadow:0 8px 30px rgba(0,0,0,0.16);padding:var(--spacing-xl);margin-top:-80px;position:relative;z-index:2}.form-input,.form-select,.form-textarea{width:100%;padding:0.75rem 1rem;border:1px solid #ddd;border-radius:8px;font-family:var(--body-font);font-size:1rem;transition:all var(--transition-fast)}.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(229,57,53,0.2);outline:none}
    </style>
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="critical.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="emergency-scripts.js" as="script">
    <link rel="preload" href="images/tyrehero-logo.svg" as="image">
    
    <!-- Font Loading Optimization -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700&display=swap"></noscript>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="images/tyrehero-logo.svg">
    <link rel="apple-touch-icon" href="images/tyrehero-icon-192.png">
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function(registration) {
                        console.log('TyreHero SW registered:', registration.scope);
                        
                        // Handle updates
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content is available, reload
                                    if (confirm('New version available! Reload for better performance?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('TyreHero SW registration failed:', error);
                    });
            });
        }
    </script>
    
    <!-- Performance Monitoring -->
    <script>
        // Core Web Vitals tracking
        function trackWebVitals() {
            // Track Largest Contentful Paint (LCP)
            new PerformanceObserver((entryList) => {
                const entries = entryList.getEntries();
                const lastEntry = entries[entries.length - 1];
                console.log('LCP:', lastEntry.startTime);
                
                // Send to analytics (replace with actual endpoint)
                // analytics.track('lcp', lastEntry.startTime);
            }).observe({entryTypes: ['largest-contentful-paint']});
            
            // Track First Input Delay (FID)
            new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    console.log('FID:', entry.processingStart - entry.startTime);
                    
                    // Send to analytics
                    // analytics.track('fid', entry.processingStart - entry.startTime);
                }
            }).observe({entryTypes: ['first-input']});
            
            // Track Cumulative Layout Shift (CLS)
            let clsValue = 0;
            new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    if (!entry.hadRecentInput) {
                        clsValue += entry.value;
                    }
                }
                console.log('CLS:', clsValue);
                
                // Send to analytics
                // analytics.track('cls', clsValue);
            }).observe({entryTypes: ['layout-shift']});
        }
        
        // Initialize Web Vitals tracking
        if (typeof PerformanceObserver !== 'undefined') {
            trackWebVitals();
        }
    </script>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="preloader-content">
            <svg class="preloader-logo" width="100" height="100" viewBox="0 0 100 100">
                <path d="M40,20 L60,20 L70,30 L60,80 L40,80 L30,30 Z" fill="#e53935" />
                <path d="M47,35 L53,35 L50,45 L55,45 L45,65 L48,50 L43,50 Z" fill="#FFCC00" />
            </svg>
            <div class="preloader-text">TyreHero</div>
            <div class="preloader-spinner"></div>
        </div>
    </div>


    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <picture>
                            <source srcset="images/tyrehero-logo.webp" type="image/webp">
                            <img src="images/tyrehero-logo.svg" alt="TyreHero Logo" class="logo-image" width="120" height="40" loading="eager">
                        </picture>
                    </a>
                </div>
                <nav class="main-nav">
                    <button class="menu-toggle" aria-label="Toggle Menu" onclick="toggleMobileMenu()">
                        <span class="hamburger"></span>
                    </button>
                    <ul class="nav-menu">
                        <li><a href="emergency.html" class="nav-emergency active">Emergency</a></li>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="pricing.html">Pricing</a></li>
                        <li><a href="locations.html">Locations</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Emergency Hero Section -->
    <section class="emergency-hero">
        <div class="container">
            <div class="emergency-hero-content">
                <h1 class="hero-title">Emergency Tyre Service</h1>
                <p class="hero-description">Stranded with a flat or blown tyre? Our emergency service brings professional help directly to you within 90 minutes. Available 24/7, nationwide.</p>
                <div class="hero-cta">
                    <a href="tel:08001234567" class="btn btn-secondary btn-lg btn-icon" onclick="trackEmergencyCall()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                            <path fill="none" d="M0 0h24v24H0z"/>
                            <path d="M21 16.42v3.536a1 1 0 0 1-.93.998c-.437.03-.794.046-1.07.046-8.837 0-16-7.163-16-16 0-.276.015-.633.046-1.07A1 1 0 0 1 4.044 3H7.58a.5.5 0 0 1 .498.45c.023.23.044.413.064.552A13.901 13.901 0 0 0 9.35 8.003c.095.2.033.439-.147.567l-2.158 1.542a13.047 13.047 0 0 0 6.844 6.844l1.54-2.154a.462.462 0 0 1 .573-.149 13.901 13.901 0 0 0 4 1.205c.139.02.322.042.55.064a.5.5 0 0 1 .449.498z" fill="currentColor"/>
                        </svg>
                        Call Now: 0800 123 4567
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Emergency Form Section - Optimized for Offline -->
    <section class="emergency-form-section">
        <div class="container">
            <div class="emergency-form-container">
                <h2>Request Emergency Service</h2>
                <p>Fill out this form and we'll dispatch a technician to your location as soon as possible.</p>
                
                <form class="emergency-form" id="emergencyForm" onsubmit="handleEmergencySubmit(event)">
                    <div class="form-group">
                        <label for="name" class="form-label">Your Name</label>
                        <input type="text" id="name" name="name" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input type="tel" id="phone" name="phone" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="location" class="form-label">Your Location</label>
                        <input type="text" id="location" name="location" class="form-input" placeholder="Address or description of your location" required>
                        <button type="button" onclick="requestLocation()" class="btn-location">📍 Use My Location</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="vehicle" class="form-label">Vehicle Make & Model</label>
                        <input type="text" id="vehicle" name="vehicle" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="issue" class="form-label">Tyre Issue</label>
                        <select id="issue" name="issue" class="form-select" required>
                            <option value="">Select issue</option>
                            <option value="flat">Flat Tyre</option>
                            <option value="blowout">Blowout</option>
                            <option value="puncture">Puncture</option>
                            <option value="damaged">Damaged Tyre</option>
                            <option value="other">Other Issue</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="details" class="form-label">Additional Details</label>
                        <textarea id="details" name="details" class="form-textarea" placeholder="Any additional information that might help us assist you better"></textarea>
                    </div>
                    
                    <div class="form-submit">
                        <button type="submit" class="btn btn-primary btn-lg">Submit Emergency Request</button>
                    </div>
                    
                    <div id="offline-indicator" class="offline-indicator" style="display: none;">
                        ⚠️ You're offline. Your request will be submitted when connection is restored.
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Load non-critical CSS asynchronously -->
    <link rel="stylesheet" href="styles.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="styles.css"></noscript>
    
    <!-- Load optimized JavaScript asynchronously -->
    <script src="emergency-scripts.js" async></script>
    
    <script>
        // Inline critical JavaScript for emergency functionality
        
        function trackEmergencyCall() {
            console.log('Emergency call initiated');
            // Track emergency call attempts
            if (typeof gtag !== 'undefined') {
                gtag('event', 'emergency_call', {
                    'event_category': 'Emergency',
                    'event_label': 'Phone Call',
                    'value': 1
                });
            }
        }
        
        function requestLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // Store coordinates for emergency services
                        localStorage.setItem('emergencyLocation', JSON.stringify({
                            lat: lat,
                            lng: lng,
                            timestamp: Date.now()
                        }));
                        
                        // Reverse geocoding would normally happen here
                        document.getElementById('location').value = `Location detected (${lat.toFixed(4)}, ${lng.toFixed(4)})`;
                        
                        console.log('Location acquired for emergency:', { lat, lng });
                    },
                    function(error) {
                        alert('Location access denied. Please enter your location manually.');
                        console.error('Geolocation error:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000 // 5 minutes
                    }
                );
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }
        
        function handleEmergencySubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const emergencyData = {};
            formData.forEach((value, key) => {
                emergencyData[key] = value;
            });
            
            // Add location data if available
            const savedLocation = localStorage.getItem('emergencyLocation');
            if (savedLocation) {
                emergencyData.coordinates = JSON.parse(savedLocation);
            }
            
            // Add timestamp and ID
            emergencyData.timestamp = new Date().toISOString();
            emergencyData.requestId = 'emr_' + Date.now();
            
            console.log('Emergency request data:', emergencyData);
            
            // Attempt to submit (will be handled by service worker if offline)
            submitEmergencyRequest(emergencyData);
        }
        
        async function submitEmergencyRequest(data) {
            try {
                const response = await fetch('/api/emergency-request', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showSuccessMessage(data.name);
                } else {
                    throw new Error('Network response was not ok');
                }
            } catch (error) {
                console.log('Submission failed, will retry when online:', error);
                showOfflineMessage(data.name);
            }
        }
        
        function showSuccessMessage(name) {
            const form = document.getElementById('emergencyForm');
            form.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; color: #2E7D32; margin-bottom: 1rem;">✅</div>
                    <h3>Emergency Request Submitted</h3>
                    <p>Thank you, ${name}. Your emergency request has been received.</p>
                    <p>A technician will be dispatched to your location shortly. You will receive a confirmation text message with estimated arrival time.</p>
                    <p>For immediate assistance, please call: <a href="tel:08001234567">0800 123 4567</a></p>
                </div>
            `;
        }
        
        function showOfflineMessage(name) {
            const form = document.getElementById('emergencyForm');
            form.innerHTML = `
                <div style="text-align: center; padding: 2rem; background: #FFF3CD; border: 1px solid #FFEAA7; border-radius: 8px;">
                    <div style="font-size: 3rem; color: #FF8F00; margin-bottom: 1rem;">⚠️</div>
                    <h3>Request Queued (Offline)</h3>
                    <p>Thank you, ${name}. Your emergency request has been saved and will be submitted when your connection is restored.</p>
                    <p><strong>For immediate assistance, please call:</strong></p>
                    <a href="tel:08001234567" class="btn btn-primary btn-lg" style="margin: 1rem 0;">📞 0800 123 4567</a>
                    <p style="font-size: 0.9rem; margin-top: 1rem;">Your request is safely stored and will be automatically sent when you're back online.</p>
                </div>
            `;
        }
        
        function toggleMobileMenu() {
            // Simple mobile menu toggle
            const menuToggle = document.querySelector('.menu-toggle');
            const navMenu = document.querySelector('.nav-menu');
            
            menuToggle.classList.toggle('menu-open');
            navMenu.classList.toggle('menu-open');
            document.body.classList.toggle('menu-open');
        }
        
        // Monitor connection status
        function updateConnectionStatus() {
            const indicator = document.getElementById('offline-indicator');
            if (indicator) {
                if (navigator.onLine) {
                    indicator.style.display = 'none';
                } else {
                    indicator.style.display = 'block';
                }
            }
        }
        
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        
        // Initialize
        updateConnectionStatus();
        
        // Auto-acquire location for emergency scenarios
        if (navigator.geolocation && !localStorage.getItem('emergencyLocation')) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    localStorage.setItem('emergencyLocation', JSON.stringify({
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        timestamp: Date.now()
                    }));
                },
                function(error) {
                    console.log('Background location acquisition failed:', error);
                },
                {
                    enableHighAccuracy: false,
                    timeout: 5000,
                    maximumAge: 600000 // 10 minutes
                }
            );
        }
    </script>
</body>
</html>